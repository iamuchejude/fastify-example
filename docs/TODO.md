# fastify-example - TODO

## TODO

* [x] general: bump release to '2.4.0' ... ok
* [x] general: update dev dependencies to latest ... ok, updated even standard from 13.x ('13.1.0' to 14.x ('14.0.0')
* [x] general: use Node.js assertions but in strict mode now, as seen in [Assert - API - latest - Node.js](https://nodejs.org/dist/latest/docs/api/assert.html#assert_strict_mode); do it with `const assert = require('assert').strict` instead of the usual `const assert = require('assert')` ... doc say added in Node.js 9.9.0 but with 8.16.1 is available; but it's not available in Node.js 8 LTS (8.9.0) ... ok, because here I'm already requiring Node.js 10 LTS as minimum version, so it's good to apply this change now
* [x] general: check if use a trick like exporting all required modules in a specific source even here, as seen [here](https://school.geekwall.in/p/SkXDyiODV/managing-npm-functions-in-node) ... maybe later
* [x] general: remove the rule that disables lint rule "eslint no-prototype-builtins" (just added as a workaround after the update to latest 'standard') ... wip
* [x] general: update requirements to latest Fastify release ('^2.5.0' or later), as seen in [Fastify - Releases - GitHub](https://github.com/fastify/fastify/releases), even in README ... updated to latest ('2.7.1' at the moment) ... wip
* [x] general: update all dependencies to latest ... wip
* [x] content: expose a uri ('/info') for an api that returns some info on the current process grouped by type, like: process (pid, hostname, Node.js version, etc), OS (name, release, etc), frameworks (release, list of plugins loaded if available, etc) ... do it but by using related plugin (when available) ... wip
* [x] content: expose a uri (‘/version’) for an api that returns some release related info, like: package name, package version, git hash/tag/branch, etc ... do it but by using related plugin (when available) ... wip
* [x] content: as a sample, add customizations to current styles with a theme css file (one or more) ... so move in a dedicated theme some styles/colors/etc currently not used (but of course not structural definitions) and use it to override normal styles (for example new ocean related colors) ... wip
* [x] content: check if use [Stencil - npmjs](https://www.npmjs.com/package/@stencil/core) for Web Components as client side UI, at least in a new SPA here ... wip
* [x] content: as a sample, provide a route to serve SPA (all client-side UI) via [Preact - npmjs](https://www.npmjs.com/package/preact) (like React but without transpillation of code and Babel usage, so simpler), doing something like described in the article [Fastify and Preact for quick web app prototyping - Loige](https://loige.co/fastify-and-preact-for-quick-web-app-prototyping/); but as a Single-Page-Application (SPA) in a dedicated route; for the implementation follow the analysis already done here ... wip
* [x] content: check if provide an SPA (maybe a new one) even as a Progressive Web-App (PWA), for example as seen [here](https://blog.heroku.com/how-to-make-progressive-web-app) ... wip
* [x] content: use [ramda - npmjs](https://www.npmjs.com/package/ramda) to do some processing operations on data ... wip

* [ ] general: update requirements to Node.js 12 when LTS, to be able to use all the new (great) stuff like Class properties (public and private) etc; note that since 12.7.0 it's possible to let it be aware of resource limit when running inside a Container ...

* [ ] content: add something protected by authentication; maybe here start with something really simple, with some fixed user/group/role, but defined via env ('fastify-env'), not hardcoded in code ...
* [ ] content: add other routes, but in a dedicated source (or folder) ...
* [ ] content: add error handlers ...
* [ ] content cleanup/update to latest standards my custom styles ...
* [ ] content: remove my custom styles from pages and change with some good default style, for example starting from latest [Bootstrap](https://getbootstrap.com/), then update licenses ...
* [ ] content: start to use [marko](https://markojs.com/), but in a branch (to merge later info master, and before it, create a maintanance branch for ejs) ...


---------------


## DONE

* [x] general: create/update initial skeleton (from an existing example) and tag it in git ... ok
* [x] general: update dependencies/devDependencies etc in 'package.json', references to my remote repository, etc ... ok
* [x] general: update the sample code with my standards (formatting, port 8000 for the dev server, etc) ... ok
* [x] general: add License header in all source files ... ok
* [x] general: update to Fastify 1.0.0 (just released), and related plugins, to ensure all work ... ok, done and tested
* [x] general: update README to add reference to Dockerfile-usage ... ok
* [x] general: add a precommit hook that trigger tests before a git commit ... maybe later

* [x] content: add some simplified sources and resources (templates, pages, etc), to use as a base (and example) for others ... ok
* [x] content: add 'nodemon' in devDependencies to be able to reload all content (even sources) in DEV environment ... ok
* [x] content: printing routes at server startup, but only for non production environments ... ok

* [x] example: use fastify options to change log level, etc ... ok
* [x] example: use the 'fastify-favicon' plugin, to test it ... done (in page, still not in tests), but when calling [favicon.ico - localhost 8000](http://localhost:8000/favicon.ico) still it doesn't return the requested resource (should be published by the plugin)... ok, needed to update to a newer release of the plugin ('0.1.1')
* [x] example: tag initial release (but without changing release number in 'package.json') ... ok
* [x] example: use the 'fastify-webhook' plugin, to test it ... but for now don't add specific unit tests here ... ok
* [x] example: test 'fastify-webhook' plugin, even from a CLI tool like curl, for example run the server with: `npm start` and check with a Browser that the [Home page](http://localhost:8000) is reachable; then in another terminal do: `curl http://127.0.0.1:8000/webhook -X POST -H "Content-Type: application/json" -d '{"payload":"test"}'` => returning a JSON response (maybe in this case a dump of the given data), and no error thrown ... yes but maybe it would be better to have another example server script ... done, but note that on Windows I need to do the curl call in this way (in the json data using a double quote but escaping it in json fields), so: `curl http://127.0.0.1:8000/webhook -X POST -H "Content-Type: application/json" -d "{\"payload\":\"test\"}"`; check if I could move that data in a file (for example 'body.json') and point to it with: `curl http://127.0.0.1:8000/webhook -X POST -H "Content-Type: application/json" -d @body.json` not only for Windows; expected response: `{"statusCode":200,"result":"success"}` ... ok
* [x] example: update usage of 'fastify-webhook' plugin, to better test it, but keep previous code commented (for a minimal sample usage) ... ok, so now try to call it for example with (from Windows): `curl http://127.0.0.1:8000/custom-webhook -X POST -H "Content-Type: application/json" -d "{\"payload\":\"test\"}"`, otherwise remove the escape of double quote chars and keep the rest for Linux/Mac: `curl http://127.0.0.1:8000/custom-webhook -X POST -H "Content-Type: application/json" -d '{"payload":"test"}'`

* [x] general: update to latest (post-1.0.x) stable Fastify ... ok, so for now use '^1.2.1'

* [x] general: update npm custom commands to run unit tests to not call 'standard' directly, but to call its custom task 'lint' defined in this project ... ok, done; note that calling only 'standard' (but always better to call the local installation of it) without arguments let it scan all folders in the project, so in this case passing the list of folders/subfolders to scan should be better/faster
* [x] general: like in Fastify (and its core plugins), check if remove the dev dependency on 'request', and instead use 'simple-get' ... changed, now update all tests ... ok, done; but improve later all tests here
- general: add a dependency on [is-docker](https://www.npmjs.com/package/is-docker), to change (in the server script) the listening address to '0.0.0.0' when in Docker, as in [fastify-cli - Fastify](https://github.com/fastify/fastify-cli); anyway the change to replicate in this project is shown [here](https://github.com/fastify/fastify-cli/commit/0d581c474bd6c7ade5c292decf5fe1062c1e5e03) ... added in dependencies, but need to use it now ... ok, done
* [x] general: check if use [fast-json-stringify - Fastify](https://github.com/fastify/fast-json-stringify) to generate (and maybe even validate) output in JSON; should be faster that 'JSON.stringify' ... try to use it in some function in the 'utils.js' module ... added in dependencies ... ok, but use later in utils
* [x] general: like in Fastify (and its core plugins), check if remove the dev dependency on 'request', and instead use 'simple-get' ... changed, now update all tests ... ok, done; but improve later all tests here
* [x] general: check if empty peerDependencies and move them under devDependencies in 'package.json'; for more info see even [peer-dependencies - node.js](https://nodejs.org/en/blog/npm/peer-dependencies/) ... try removing 'request' from dev dependencies and (like other Fastify core plugin) use 'simple-get'; but first try emptying peerDependencies, from: '''
"ajv": "^5.0.0",
"eslint-plugin-import": "^2.8.0",
"eslint-plugin-promise": "^3.6.0",
"eslint-plugin-react": "^7.6.1"
 ''' ... ok, and all tests seems to run well
* [x] general: in the example, use latest version of my 'fastify-favicon' plugin ('0.2.1'), to test it ... ok
* [x] general: after latest updates (as of today, 2018-04-13), check why the response for any page is very very slow, urgent ... note that even after a manual cleanup of 'node_modules' folder and redo an 'npm install' nothing changed; but it I open Browser Developer Console all seems to be good (both in latest Firefox and Chrome); check with Fastify guys, urgent ... not sure it's a bug, so for now I just opened an help request [here](https://github.com/fastify/help/issues/9) ... now check as suggested, and then maybe debug 'fastify-static' ... no wait, probably the issue is this: [issue#50 - fastify-static](https://github.com/fastify/fastify-static/issues/50) and maybe even [issue#23 - node-fastify-auto-push](https://github.com/google/node-fastify-auto-push/issues/23) even if not strictly related to my usage; so wait for the fix and a new release of 'fastify-static' to test ... ok, with '0.10.1' the problem is resolved
* [x] general: update to latest Fastify 1.3.0 (just released) and related plugins, to ensure all work ... ok, done and tested
* [x] general: update to latest Fastify 1.4.0 (just released) and related plugins, to ensure all work; then update CHANGELOG, commit and tag ... ok
* [x general: start to move to ES Modules, enabled since Node.js 10 as seen [here](https://levelup.gitconnected.com/whats-new-in-node-10-ad360ae55ee4); look [here](https://medium.com/@giltayar/native-es-modules-in-nodejs-status-and-future-directions-part-i-ee5ea3001f71) for an overview ... do only some trivial changes accordingly to [package.json - npmjs](https://docs.npmjs.com/files/package.json) ... maybe later do more
* [x] general: update npm custom commands to use local installed tools via [npx](https://www.npmjs.com/package/npx) ... note that should already be installed with latest npx, but if not (sometimes in Windows) install with `npm install -g npx`, then check with `npx --version` ... no, because as seen [here](https://michael-kuehnel.de/tooling/2018/03/22/helpers-and-tips-for-npm-run-scripts.html), npx can't run npm custom commands but instead is made for run local tools; anyway, simplify 'package.json' to remove './node_modules/.bin/' from any custom command, and (recommended) remove those (and in general any if possible) global npm packages
* [x] general: update the example (and first the test) to show a sample with custom options, and let it work with a sample 'favicon.ico' (16x16) generated with GIMP ... note that it seems that there is a problem in 'fastify-favicon' with custom path (both absolute and relative to server script); check from the 'temp' folder with `wget http://localhost:8000/favicon.ico --no-cache` (or similar with 'curl') and then open generated file to ensure it's the custom favicon; then update changelog, release number, etc ...  ok, but no issue raised because it was due to a wrong path given; so updated readme and the example
* [x] general: update all core dependencies on Fastify and related plugins ... ok
* [x] general: run all even with Node.js 10.x.x, to check if everything works (as should) ... ok, all works even with Node.js 10.1.0
* [x] example: update 'fastify-webhook' to latest version ... ok

* [x] general: check licenses of dependencies, for example with [legally - npm](https://www.npmjs.com/package/legally) or with [license-checker - npm](https://www.npmjs.com/package/license-checker); then repeat after some time ... ok, used 'legally' but run via npx, all seems to be good
* [x] general: update to latest Fastify (1.7.0), and update diagnostic code on the listening address and port using the new syntax ... ok
* [x] general: change all references to js sources by removing its '.js' explicit extension, to be more future proof for using Node.js modules ('.mjs') since Node.js 10 ... ok, done in 'package.json' commands and even when using 'handlers' from 'fastify-webhook' for example

* [x] general: update sample docker-related files with some best practices, as seen [here](https://nodesource.com/blog/containerizing-node-js-applications-with-docker/) ... maybe later
* [x] general: add some example route to use the async/await syntax, as seen in [Fastify goes LTS with 1.0.0 - Medium](https://medium.com/@fastifyjs/fastify-goes-lts-with-1-0-0-911112c64752) ... maybe later

* [x] example: use the 'fastify-cloudevents' plugin, to test it (configure it for a common usage scenario, and add a /time route) ... but for now don't add specific unit tests here ... ok, even if 'loggingCallback' does some noise (additional output for the dump of related Cloudevents) in the console

* [x] general: change template engine from 'ejs' to [Nunjucks](https://mozilla.github.io/nunjucks/) or [Marko](https://markojs.com), but in a branch (and merge later into master) ... maybe later, or in another repository
* [x] example: update 'point-of-view' to latest version (when published) ... ok
* [x] general: update all core dependencies on Fastify and related plugins ... ok, and often repeat this task
* [x] example: add some minimal unit test to ensure published routes are available (at least that for the home page), using  'simple-get' (already available in devDependencies); and that some are no more available (default webhook url for example, but that the new one it is) ... maybe later
* [x] general: in the branch 'add-fastify-nats', use my fork of 'fastify-nats', with its temporary name 'fastify-nats-client' and ensure all is good; but do not merge those changes into master ... ok
* [x] general: update dependencies to latest Fastify 1.x (1.13.1) and all plugins ... ok
* [x] general: in the branch 'add-fastify-nats', revert the use of 'fastify-nats-client' and use the new version of 'fastify-nats' (one time it has been published) and ensure all is good; then merge those changes into master (via Pull Request) ... maybe later (see next comment)
* [x] example: in the branch 'add-fastify-nats' branch, use the 'fastify-nats' pligin to send/receive messages with a publiuc NATS server; but instead (at least for now) use my fork of that plugin, 'fastify-nats-client' that has some more features and more updates ... ok, but do not merge this branch because in some cases the external NATS server could not be reachable (for example by corporate firewall rules), instead keep it not merged and see later if/what to do
* [x] general: add badges at the top of README ... ok
* [x] general: update 'fastify-cloudevents' to latest release ('0.2.0' or later), and update server script (some TODO in sources are for this) ... ok
* [x] general: update dependencies etc ... ok
* [x] general: add 'dotenv' in dependencies, to be able to define some environment-dependent variables in a '.env' file (excluded by source control) and have all them populated as environment variables ... ok, but use later if/when needed
* [x] example: in the branch 'add-fastify-nats' branch, use the 'fastify-nats' pligin to send/receive messages with a publiuc NATS server; but instead (at least for now) use my fork of that plugin, 'fastify-nats-client' that has some more features and more updates ... ok, but do not merge this branch because in some cases the external NATS server could not be reachable (for example by corporate firewall rules), instead keep it not merged and see later if/what to do
* [x] general: rebase the branch 'add-fastify-nats' on top of updated master ... ok, but instead of rebase I used a Pull Request (PR) and GitHub Review and Web UI to fix conflicts
* [x] general: to handle command-line options, use [yargs-parser](https://www.npmjs.com/package/yargs-parser) (already used in other Fastify-related projects) ... maybe later
* [x] general: to improve the NATS queue feature (usage), add a command-line flag to disable the publish/subscribe of messages to the public NATS server (and add an npm custom command with that flag) ... no, use an environment variable instead (see related note)
* [x] general: to improve the NATS queue feature (usage), configure the NATS server URL with the environmental variable NATS_SERVER_URL (for example using .env file), and use NATS_SERVER_DISABLE to disable it (and related features), instead of using command-line arguments/flags ... ok
* [x] general: in the '.env' (local, not in source control, as per best practices), comment the line with `NATS_SERVER_DISABLE=true`, and ensure all works as before ... ok
* [x] general: fix TODO in the `route` source, to be able to use publish/subscribe functions ... ok
* [x] general: to improve the NATS queue feature (usage), add even a counter for messages sent and received ... maybe later (not really needed now)
* [x] general: tag sources as '0.11.0' ... ok
* [x] general: tag sources as '0.11.1' with latest changes (see CHANGELOG and README)... ok
* [x] general: like in Fastify, add a custom npm command to perform a license check (but for production dependencies only) using 'license-checker', with only some acceptable licenses ('Apache-2.0;BSD-2-Clause;BSD-3-Clause;MIT;ISC'); some more info on Apache compatible/incompatible licenses [here](https://www.apache.org/legal/resolved.html#what-can-we-not-include-in-an-asf-project-category-x) ... done, but check what to do for a package that has a license (incompatible) 'Artistic-2.0'; note that even some npm related packages use that license, so a good compromise (for now) is to add it in acceptable licenses (even in the Apache compatibility page is not explicitly forbidden so should be good the same) ... note that this npm custom command still raise errors because other dependencies are found, fix later by removing my dependencies (using them) ... maybe later
* [x] general: on license-checker, for private npm packages still is seems that an 'UNLICENSED' license is assigned (without reading related license) ... ok, could be a bug in the library
* [x] general: get webhook secretKey from an environment variable (so could be defined like others enev in the '.env' file) or null, then test all cases (not present, present but wrong, present and good) ... ok
* [x] general: add a dev dependency on [ESDoc](https://www.npmjs.com/package/esdoc) and related plugins for esnext, etc, and the add an npm custom command to generate doc (in the usual output folder 'out' already excluded by '.gitignore'); and provide a configuration file for it (.esdoc.json') as seen in their docs ... ok
* [x] general: use ESDoc to generate the right documentation, at least for public functions (from folders './src/', and maybe even for './example/', './test/'), and add an npm custom task to generate/update it, but in this case in the './out/' folder (already excluded from commits, via '.gitignore') instead of the usual './docs/' ... ok, all done in the '.esdoc.json' configuration file
* [x] general: tag sources as '0.12.0' ... ok
* [x] general: simplify and generalize paths, and improve templates (and use common variables to merge with specific variables when using templates); move folders names into constants (maybe in a Map); then ensure all works as before ... ok
* [x] general: enable functions using feature flags (set in the environment) ... for NATS queue keep the (already existing) NATS_SERVER_DISABLE env var; for others check if/when to use a disable flag or an enable one ... ok, but used a disable logic, so by default any feature is enabled
* [x] general: move in a new source ('features.js') all code blocks that load?register/configure/etc application features; note that related source must accept arguments, so it has to be exposed as a function (or as a class) ... ok, implemented/exposed as a function (at least for now)
* [x] general: remove dependency on 'dotenv' and use its wrapper 'fastify-env' instead ... no, I tried but the plugin works in a way different that my setup here: all variables to read must be declared in the schema (which is good), are populated in async, etc; so I prefer ro revert to normal 'dotenv' usage
* [x] general: move listen port in the constants source (like others) ... ok, and removed from fastifyOptions because it was there only to be used manually
* [x] general: handle Fastify main options (for example the logger level, etc) via an environment variable (like for many other options); check if even the whole js object would be accepted in an env var (and by default use current value I used); then update README ... ok, and of course I had to write it as a JSON string, so: '{ "logger": { "level": "info" } }'; chose to used this as a default instead of an empty object ('{ }')
* [x] general: change all callbacks to follow best practices, so: ensure that a callbacks is callable (if it's a function), always pass error parameter first with something like 'function callback (err, data) { }', inside a callback always check for its error parameter (if not null), etc ... so here fix callbacks for cloudevents and callbacks for nats (check if related plugins must be updated before) ... note that for nats callbacks (cb) it seems no possible due to the underlying implementation ... maybe later, after 'fastify-cloudevents' release '0.3.0' or later (if callbacks will be changed with that format)
* [x] general: send some CloudEvent events (serialized) the the NATS queue ... done, now test all with nats feature enabled (then re-disable it) ... ok
* [x] general: as usual, update all dependencies to latest release ... ok
* [x] general: tag sources as '0.13.0' ... ok
* [x] general: check if use [require-all](https://www.npmjs.com/package/require-all) to load many/all source ('.js' and maybe even all '.json') files from a given folder, but filtered ... maybe later
* [x] general: check if use [fastify-acl-auth](https://www.npmjs.com/package/fastify-acl-auth) for a generic authentication and authorization flow for routes here ... maybe later
* [x] content: check if use [fastify-nextjs](https://www.npmjs.com/package/fastify-nextjs) to have a pre-configured (and simplified, ready to use) environment with React pages rendered at Server-Side, using [next](https://www.npmjs.com/package/next); but note that next has many dependencies; check if it could render pages even at client side; note that next can render even to static pages (to have a fully static web site); anyway try in a branch ... maybe later
* [x] content: check if add in 'package.json' a proxy statement like `"proxy": "http://localhost:8000/"`, as seen in [Proxying API Requests in Development - Create React App](https://facebook.github.io/create-react-app/docs/proxying-api-requests-in-development), [How to get create-react-app to work with a Node.js back-end API - freeCodeCamp](https://medium.freecodecamp.org/how-to-make-create-react-app-work-with-a-node-backend-api-7c5c48acb1b0), [Setting up a proxy server in create-react-app - vschool](https://coursework.vschool.io/setting-up-a-full-stack-react-application/), etc ... maybe later, because at the moment here I don't use React for the client part so I don't have a subproject in a folder '/client/' (and related 'package.json' where to put that setting); check if it would be useful the same with a different framework for client side, like Angular
* [x] general: add npm custom command to run unit tests with nodejs debugger breaks enabled (inspector) and no parallel and no timeout, useful for example in Visual Studio Code; some info [here](https://github.com/fastify/fastify/blob/master/docs/Testing.md), [here](https://nodejs.org/en/docs/guides/debugging-getting-started/), [here](https://code.visualstudio.com/blogs/2018/07/12/introducing-logpoints-and-auto-attach) ... ok, added a debugger attach configuration (in '.vscode/launch.json'), and an npm custom command 'test:unit:debug' to run Tap unit tests with Node.js inspector enabled (and without timeout)
* [x] general: implement some automation tool, using [Gulp](https://gulpjs.com/) or [WebPack](https://webpack.js.org/) ... maybe later, but with [WebPack](https://webpack.js.org)
* [x] general: rewrite all using latest [TypeScript](https://www.typescriptlang.org/), but in a branch (and merge later into master) ... maybe later, or (even better) in a similar project 'fastify-example-ts'
* [x] general: update folders for pages (public, templates, etc) to move all under a 'web' or 'pages' folder (but with 'git mv' to not losing files history) ... maybe later
* [x] general: check if introduct the [TypeScript]() compile, maybe only to let it check JavaScript code, as seen [here](https://slack.engineering/typescript-at-slack-a81307fa288d) and [here](https://blog.bitsrc.io/why-and-how-use-typescript-in-your-react-app-60e8987be8de) ... maybe later, but do changes in a branch
* [x] general: in 'features.js' source, check if add an internal function that uses `const NODE_ENV = process.env` to give only env var name (as a string), to hide that's reading from the env ... ok, but added in utilities functions, in 'utils.js'
* [x] general: refactor main server source as described in [Testing - fastify](https://github.com/fastify/fastify/blob/master/docs/Testing.md), for simpler testing and have Fastify instance exposed by a specific source (maybe a new here here) ... maybe later
* [x] general: as a sample, under the folder './docs/', add a copy of Visul Studio Code launch configurations (copied from project root '.vscode/launch.json') because usually the folder '.vscode/' is excluded by git (by adding it in '.gitignore') ... ok
* [x] general: as a sample, under the folder './docs/', add a copy of a sample local environment variables configurations (copied from project root '.env' but renamed into '_env') because usually that file (and related variants) is excluded by git (by adding it in '.gitignore') ... ok
* [x] general: enable strict mode in all created CloudEvent instances if environment is not production ... better, use a feature flag like others (so something like 'FEATURE_CLOUDEVENTS_STRICT_DISABLE') and get it from env vars (so disable/enable it in any specific environment); then update related info in the README ... ok
* [x] general: check how to pass to the Docker container all environment variables used here (called 'feature flags', and maybe even others); see [Builder - Docker Docs](https://docs.docker.com/engine/reference/builder/#arg); and the same for env vars; note that ARG variables (set via the '--build-arg' flag to 'docker build' command) are not persisted into the built image, but ENV variables (set via the '--env' flag in 'docker run/exec' commands) yes; and ENV variables have priority over ARG variables, so a good trick is to set ARG and then ENV to refer to it but with a default value; maybe then check if use even for specify a user for running the node process in the container, andthe production mode (or not) for npm install, etc ... ok, but maybe later
* [x] general: improve Docker image generated here using some tricks seen [here](https://blog.bitsrc.io/manage-your-node-app-using-docker-like-a-pro-6266f6516cf), like multi-stage image, etc ... maybe later, not really needed here at the moment (no package generation via WebPack or other similar)
* [x] general: improve the flow and data transformation paths using CQRS and Event Sourcing (ES), for example as seen [here](https://blog.bitsrc.io/building-a-cqrs-es-app-with-resolve-41f839362ffd) ... maybe later, not really needed here now
* [x] general: check if the warning "Promise may not be fulfilled with 'undefined' when statusCode is not 204" (since Fastify 1.13.4) is related to the 'ejs' templating engine ... ok, it was related to exposing routes as an async function, and even the '/template' route was defined with an async function but without return value, so for now I fixed all by moving back to normal (non-async) functions; let's improve later
* [x] general: update all dependencies, mainly to latest 'fastify-cloudevents' release '0.3.0' or later ... ok, all works good as before
* [x] general: change all callbacks to the (standard) arguments format like 'function callback (err, data) { }', could call the callback with (err, null) or with (null, data) ... no, it doesn't worth the effort because at the moment I'm not using so much async functions here, and normal callbacks are good enough at the moment
* [x] general: update info in the README and CHANGELOG ... ok
* [x] general: tag sources as '0.14.0' ... ok
* [x] content: check if/how to use [lit-html](https://lit-html.polymer-project.org/guide) and [lit-element](https://lit-element.polymer-project.org/guide) as templating/view engine; but note that at the moment there is not plugin (nor support in 'point-of-view') ... no, it's too early now and related Server-Side Rendering (SSR) is provided only by a third party library (otherwise those modules works only at client side); but maybe later
* [x] general: update all dependencies and all my plugins to latest, for example 'fastify-cloudevents' ... ok
* [x] content: remove some inline definition/behavior and use instead those exposed by the new release of 'fastify-cloudevents' ... ok
* [x] general: bump release ... no, because here I keep the same release (at least for now on '1.0.0') and I tag sources at the end of any minimal and continuous release
* [x] general: Docker image, in the 'Dockerfile', add some LABEL statements to add more info on Node.js version, Fastify version, etc; if possible the same statement but multi-line ... maybe later
* [x] general: Docker image, in the 'Dockerfile', add an argument (ARG), and its override from environment (ENV) for specifying if install production only dependencies or not (all dependencies, even for dev) ... ok, but keep 'development' as default
* [x] general: Docker image, in the 'Dockerfile', group all ENV statements in a single one but multi-line (one key/value per line), should be possible ... maybe later
* [x] general: Docker image, in the 'Dockerfile', do some small tweaks and improvements, using official [Node.js Docker image](https://hub.docker.com/_/node/) by default based on Debian ... ok; created even a group and user to run the webapp (in a safer way, instead of the default root in Docker containers) and related file system permissions in its folders, as seen [here](https://www.digitalocean.com/community/tutorials/how-to-build-a-node-js-application-with-docker) for example
* [x] general: Docker image, check using the alpine version, so 'node:8-alpine' (much smaller, based on BusyBox, instead of the normal node image), if it's good enough for all commands used here; and maybe add another Dockerfile for the other base image (not based on alpine, so the current one), like 'Dockerfile.dev'; but check if it would be possible to run for example the npm custom task 'healthcheck-manual', otherwise keep the alpine version as a secondary Docker image ... start by creating a dedicated 'Dockerfile.alpine' for production but not referenced in npm custom commands (maybe in a command like 'docker:build:alpine') ... ok, but used the tirck to tag the image with the same name, to be able to resuse others npm custom command already defined (most)
* [x] content: expose a route that always raise an error ... ok
* [x] general: use new features exposed by 'cloudevent' (wrapped by 'fastify-cloudevents') to build CloudEvent instances from Error, etc ... maybe later, because I need related hook (since Fastify v2)
* [x] general: update changelog ... ok

* [x] general: tag sources as '0.15.0' ... ok
* [x] general: update all my other plugins to '1.0.0' (for Fastify v1) when available: 'fastify-nats-client', 'fastify-webhook', and maybe others ... ok
* [x] general: use new features of my plugins (new releases) ... ok
* [x] general: update changelog ... ok
* [x] general: tag sources as '0.16.0' and then maybe even as '1.0.0' ... ok
* [x] general: after the '1.0.0' release, create a maintenance branch '1.x' ... ok

* [x] general: bump release to '2.0.0' ... but only when my plugin 'fastify-cloudevents' will be compatible to Fastify v2 ... ok, all updated now (mine and all others)
* [x] general: unsure all works with latest Node.js 8.x ... then ensure that publishing to NATS queues works good (on-line and even in the Docker version) ... ok
* [x] general: update to Fastify v2, but in a branch (at the beginning, until it works); then merge with a PR (but merge with squash) ... ok
* [x] general: update my code to use new/updated features of my plugins, and fix all breaking changes ... ok
* [x] general: use new features exposed by 'cloudevent' (wrapped by 'fastify-cloudevents') to build CloudEvent instances from Error, etc ... ok
* [x] general: check if use [fastify-sensible - Fastify](https://github.com/fastify/fastify-sensible), to add some standard and useful defaults ... maybe later
* [x] general: add here the same additional lint command (via TypeScript and related plugins, and maybe even with TSLint) ... no, not really needed here because all code is JavaScript, but maybe later
* [x] general: update readme ... ok
* [x] general: update changelog ... ok
* [x] general: tag sources ... ok
* [x] general: after the '2.0.0' release, create a maintenance branch '2.0.x' ... ok

* [x] content: implement a full-stack webapp, with a modern front-end (Angular or React or Vue.js or other); use even some modern css framework like Bootstrap (but without jQuery etc); for example see [React Bootstrap Tutorial - LogRocket](https://blog.logrocket.com/how-to-use-bootstrap-with-react-a354715d1121) and then use [reactstrap - npmjs](https://www.npmjs.com/package/reactstrap) or [react-bootstrap - npmjs](https://www.npmjs.com/package/react-bootstrap) and WebPack to bundle all ... maybe later because this need a change in the structure of all the repo (to become a monorepo), to be managed in a different way, as seen in [Why one big repo - Rush](https://rushjs.io/pages/intro/why_mono/); see even [here](https://itnext.io/essentials-of-monorepo-development-53992471fa8), at [Monorepo design - Babel](https://github.com/babel/babel/blob/master/doc/design/monorepo.md), etc; of course monorepo makes sense for all related subprojects (like subprojects of the same product)

* [x] general: update requirements to Node.js 10.x, at least in Docker files ... ok
* [x] general: update utils functions ... ok
* [x] general: bump release to '2.1.0' ... ok
* [x] general: update dependencies ... ok
* [x] general: add a feature flag to disable Fastify logging ... ok, with the env var FASTIFY_OPTIONS, otherwise by default Fastify logger will be enabled from the 'info' level
* [x] general: remove dependencies (and dev dependencies) not really used here ... ok
* [x] general: for a more Functional Programming (FP) approach, use [ramda - npm](https://www.npmjs.com/package/ramda) instead of usual [LoDash - npm](https://www.npmjs.com/package/lodash) or [Underscore - npm](https://www.npmjs.com/package/underscore) ... ok, but maybe later
* [x] general: add a feature flag to change the callback for CloudEvents, to send to a webhook (of course via HTTP POST) ... maybe later
* [x] general: check if restructure the whole project to become a monorepo (with multiple interdependent packages inside it, for example using [lerna - npmjs](https://www.npmjs.com/package/lerna) or [rush - npmjs](https://www.npmjs.com/package/@microsoft/rush), like: server, common, client, docs, etc ... maybe later
* [x] general: use the new release of 'fastify-cloudevents' aligned with v0.2 of the spec (when the plugin will be available); and update all accordingly (even add packageName and packageVersion to event 'type' base value, and major release to 'schemaurl' where used like '/v1/') ... ok
* [x] content: cleanup/update to latest standards my custom styles, using [autoprefixer - npmjs](https://www.npmjs.com/package/autoprefixer) and [postcss - npmjs](https://www.npmjs.com/package/postcss), and keep only last 2 versions of most common browsers ... use the online version for example at [autoprefixer - github](https://autoprefixer.github.io/) ... ok, but now to target only 1 last version of most common browsers
* [x] content: update home page with a link to a samples page (with a statically defined sorted list to all published routes, with related description) ... ok
* [x] content: check if publish lifecycle events in a different queue, and error events in another; for example use current queue name (composed of packageName and packageVersion) as base, and add '.lifecycle', '.error', and '.app' for specific messages generated inside routes, etc; then (as a sample) subscribe to all those queues, but print queue name or at least its short name (if possible) just before the message received from it ... maybe later
* [x] general: to simplify automatic changes for releases, follow the guidelines at [
Easy Automatic npm Publishes - The npm Blog](https://blog.npmjs.org/post/184553141742/easy-automatic-npm-publishes), so follow [Conventional Commits](https://www.conventionalcommits.org/) and check if use [standard-version - npmjs](https://www.npmjs.com/package/standard-version) for automatic changelog redaction ... maybe later
* [x] general: update dependencies ... ok
* [x] general: update changelog ... ok
* [x] general: tag sources, at least going to '2.1.0' ... ok

* [x] content: restructure/align my css with the [abvcss](https://abvcss.github.io/abvcss-website/) methodolgy ... maybe later
* [x] content: improve Promise and async/await usage in my code, as seen for example in [Deeply Understanding JavaScript Async and Await with Examples - Bits and Pieces](https://blog.bitsrc.io/understanding-javascript-async-and-await-with-examples-a010b03926ea) ... yes, but maybe later

* [x] general: bump release to '2.2.0' ... ok
* [x] general: at server startup, get some environment info (like Node.js version with `process.version`, OS name/type, OS release, OS platform with the old `process.platform`, etc) and print to log; implement them in the 'utils' source (but not Node.js specific code with 'require' there), and maybe later implement even similar features but for a Browser environment; some info in [os - Node.js](https://nodejs.org/api/os.html), and [here](https://coderwall.com/p/qgsnbq/check-node-js-version-in-code), [here](https://www.w3schools.com/js/js_window_navigator.asp), [here](https://stackoverflow.com/questions/8683895/how-do-i-determine-the-current-operating-system-with-node-js), etc ... for now, add some function related to `process` Node.js data structure (as some is already present, similar), but not others that require Node.js specific import; and implement Browser specific features maybe later ... enable this with a feature flag, using the env var 'FEATURE_PLATFORM_INFO_DISABLE'; note that process id (pid) and hostname are already written in Fastify logs by default ... ok, done
* [x] general: check if remove some Fastify plugins not really used at the moment, but keep 'fastify-static' (even if for a real deployment probably static assets will be delivered via NGINX or another Web Server) ... remove 'fastify-compress', 'fastify-cookie', 'fastify-session'; then ensure all works as before ... ok, maybe re-add later if/when really needed/used
* [x] general: update Tap (Node-Tap) to latest (from '^12.7.0' to '^13.0.3' or later) ... note that new Tap now complaints on a not existing nested path for test sources, so maybe I'll need to update npm custom command to remove 'test/*/*.test.js'; and (currently) it seems to complaint on the `'use strict'` statement and on eslint comments, on top of test sources, and even on anything not inside tests; check better what happens ... ok using latest tap (currently '^13.1.6'), but I had to remove the '--strict' flag in npm custom commands 'test:unit' and 'test:unit:debug'; note that still there are some eslint comments in some sources that test coverage (npm custom command 'test:coverage') doesn't like (for example the 'utils' source), check with Node-Tap guys (I get the error: `Cannot read property 'f' of undefined`); note that the first time i run tests all works, but after it all next test run fails with the same error, and I need to cleanup the 'node_modules' folder and re-install dependencies, weird; Tap guys told me to add the '--no-esm' flag and this resolve (probably they need to fix something the same, even when running with Node.js 8.16.0); updating to latest Tap ('13.1.8') there is even the bug fix for the '--strict' argument, so I can re-add it in my nom custom commands
* [x] general: remove dependency on ESDoc and related plugins ('esdoc', 'esdoc-standard-plugin', 'esdoc-ecmascript-proposal-plugin', 'esdoc-node'), not really used here; but keep its configuration file ('.esdoc.json') because it could be useful; last, remove related npm custom command ('docs' which does 'npx esdoc') ... ok
* [x] general: update to latest Fastify (currently '^2.3.0') in requirements, even if not strictly needed ... ok
* [x] general: update all requirements to Node.js 10.x (more modern, even if not strictly required here, but just to start using it); in Docker images it has already been done ... note that if run with a previous version (like Node.js 8.16.0) no error is thrown; check if there is a standard way to do this, and if there isn't enable with a feature flag ... as seen [here](https://stackoverflow.com/questions/29349684/how-can-i-specify-the-required-node-js-version-in-package-json), and even in [npm-config - npmjs](https://docs.npmjs.com/misc/config) it seems that a good way could be to run a command like `npm config set engine-strict true` from project root; otherwise I could implement by code (probably using 'semver' for a better range check, and maybe provide a configuration flag to raise a warning or raise an error, or do nothing), or use a module like [check-node-version - npmjs](https://www.npmjs.com/package/check-node-version) ... ok, and improve/implement something for this but maybe later (here or better in a dedicated Fastify plugin)
* [x] content: to improve navigation of samples routes, rename 'samples' in 'sampleRoutes' (with all routes published by my code), and add another section with 'pluginRoutes' with a (manual defined) sorted list of routes published by plugins loaded; and mark related area/div with a border ... ok, then maybe move all them in a navigation section/div
* [x] content: update header and footer with better colors, and better info, like: in header a link to Home, in footer info on framework release, webapp release, etc ... ok, done some small change even in 'style.css'
* [x] content: check why the new 'fragment-navigation' does not show in the right way navigation links (and then maybe remove from header and add there a logo) ... ok, fixed by moving the navigation fragment nested in the header (and using an include)
* [x] content: in the fragment header, add a div for main logo, like: `<div id="logo"><a href="#" alt="Logo"><img src="<%= assets %>img/logo.png'"/></a></div>` ... maybe later
* [x] general: analyse how to implement a serialization of CloudEvents into a log file ... write all into a single log file, and then (if/when needed) use an OS utility like 'logrotate' to move old log data in archive files, for example as seen [here](https://www.linode.com/docs/uptime/logs/use-logrotate-to-manage-log-files/), but when logging into JSON format, take in account even [8 Handy Tips to Consider When Logging in JSON - loggly](https://www.loggly.com/blog/8-handy-tips-consider-logging-json/), [Java Logging Guide - DataDog](https://www.datadoghq.com/blog/java-logging-guide/), etc; other useful info that could help (in general, probably not in this specific case) even [here](https://www.loggly.com/blog/what-60000-customer-searches-taught-us-about-logging-in-json/), [here](https://www.graylog.org/post/log-file-parsing), [here](https://www.baeldung.com/java-log-json-output), [here](https://stackoverflow.com/questions/52343121/how-can-i-parse-this-json-log-output-into-a-list-of-my-bean), [here](https://github.com/tersesystems/terse-logback), etc ... note that an important point is to write any log item (in JSON format, ok) alone, so when log file split should occur (or server stops or other), log file will be parseable the same, even if stricly it won't be a whole (monster ?) JSON object in its own ... ok, so let's use a (JSON) Structured Logging, and since there are several JSON objects all in one file/stream, this is called "newline delimited JSON", sometimes referred as [NDJSON](http://ndjson.org/) or [JSONLines](http://jsonlines.org/)
* [x] general: update all usual ignore files ('.gitignore', '.npmignore', '.dockerignore', etc) to add (exclude) the 'logs' folder and all its content that matches the pattern '*.log*' ... ok
* [x] general: check if/how Fastify handle terminating signals like SIGTERM, that for example could be sent when running inside Kubernetes (k8s) ... ok, it seems Fastify already handles SIGTERM or SIGINT; otherwise there is the plugin [fastify-graceful-shutdown - npmjs](https://www.npmjs.com/package/fastify-graceful-shutdown), and a discussion (maybe outdated now) [here](https://github.com/fastify/fastify/issues/260), and check with updated hook 'onClose' in [Hooks - Fastify](https://github.com/fastify/fastify/blob/master/docs/Hooks.md)
* [x] content: analyse to provide a route to serve SPA (all client-side UI); but check if this is possible without specific build phase for it ... ok, analysis done; look at [fastify-example-twitter - fastify](https://github.com/fastify/fastify-example-twitter) as a (complete) sample, where any part (frontend, common, and other parts) is in its own subfolder (with related 'package.json') and main project build/executes all them in the right way; for another interesting sample but made in TypeScript, look at [fastify-auto-push - google](https://github.com/google/node-fastify-auto-push)
* [x] content: update css by adding some colors (to move later in a theme, and use with it as override) ... ok
* [x] general: for writing rows into the log file in an efficient way, use Node.js Streams; see [Stream - Node.js API](https://nodejs.org/api/stream.html), and even [Node.js Streams - freeCodeCamp](https://medium.freecodecamp.org/node-js-streams-everything-you-need-to-know-c9141306be93), etc ... ok
* [x] general: add some useful functions using ES6 Proxy, similar to those seen in [A practical guide to Javascript Proxy - Bits and Pieces](https://blog.bitsrc.io/a-practical-guide-to-es6-proxy-229079c3c2f0) ... maybe later
* [x] general: add a feature flag to change the callback for CloudEvents, to save them in a structured log file ('.json.log', or '.jsonl') in the 'logs' folder (already added to all ignore files) ... for a performance point of view, try to write to the file as a stream (in async way if possible), and handle the file open/close by attaching to Fastify events; if log file is found at start, rename it with its timestamp at the end (so nothing will be deleted, and any run has its own log file) ... for simplicity reuse the same callback, but with two new feature flags: FEATURE_CLOUDEVENTS_LOG_CONSOLE_DISABLE, FEATURE_CLOUDEVENTS_LOG_FILE_DISABLE ... ok
* [x] general: improvement of CloudEvents log file: when the webapp starts, if a log file already exist, it will be renamed (appending the timmestamp if its last write, or the current one) so nothing is lost ... maybe later, bacause this could lead to fill disks (without un upper limit), so maybe could be implemented later with a new feature flag
* [x] general: improvement of CloudEvents log file: check why the hook 'onClose' is not triggered ... ok, is not triggered because that hook is triggered when `fastify.close()` is invoked to stop the server, see [Hooks - Fastify](https://github.com/fastify/fastify/blob/master/docs/Hooks.md), mainly per providing a 'shutdown' event to plugins; otherwise I should use the plugin [fastify-graceful-shutdown - npmjs](https://www.npmjs.com/package/fastify-graceful-shutdown) but maybe later
* [x] general: update changelog for the upcoming release ... draft written, check then update release date ... ok, updated to today
* [x] general: tag sources, at least going to '2.2.0' ... ok

* [x] general: in 'utils', check if implement features similar to those seen in the [article](https://medium.com/front-end-weekly/error-handling-in-node-javascript-suck-unless-you-know-this-2018-aa0a14cfdd9d) ... maybe later
* [x] general: implement something like [this](https://www.freecodecamp.org/news/javascript-inheritance-vs-composition-ec8ca848b6/) ... maybe later
* [x] general: for acting here even as an api server that replies even to long elaborations, check if/how to implement delayed replies: via status uri and token, via streaming, web socket, etc ... maybe later
* [x] general: at the beginning of executable scripts (like my examples or main scripts), check if add an hashbang statement: `#!/usr/bin/env node` but it must be put in the (absolute) first line of a script, so check if there are problems with license (usually put at the beginning of a source file) ... maybe later, to avoid unneeded problems (even when running those scripts in Windows where all should work the same); anyway note that now these statements are standard, see [here](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#Hashbang_comments), at this [article](https://medium.com/netscape/a-guide-to-create-a-nodejs-command-line-package-c2166ad0452e), etc
* [x] general: to publish Docker images to be run in production, use multistage images: use first stage as builder (to build content), and the second for example to publish all static content of the webapp via an HTTP Server, and/or a reverse proxy for the whole webapp; for more info look at this [article](https://itnext.io/building-docker-images-from-private-git-repositories-using-ssh-login-433edf5a18f2
) ... maybe later, because this is mainly suited for client-only apps (with only static content is deployed), so could be a good improvement, but later
* [x] general: publish current image to DockerHub, and tag there accordingly ... ok, created repository and published normal image (with tag '2.2.0' and even with default tag 'latest') and even the variant (tag '2.2.0-alpine' and 'latest-alpine'); all is at [fastify-example - smartiniatdocker09 - docker](https://cloud.docker.com/repository/docker/smartiniatdocker09/fastify-example/general); a dedicated file 'docs/Docker-publish.md' will follow with detailed info

* [x] general: bump release to '2.3.0' ... ok
* [x] general: update all dependencies to latest ... ok
* [x] general: update requirements to latest Fastify release ('^2.4.1' or later), as seen in [Fastify - Releases - GitHub](https://github.com/fastify/fastify/releases), even in README ... ok
* [x] general: add my new plugin for checking some environmental properties at runtime, see [fastify-check-runtime-env - npmjs](https://www.npmjs.com/package/fastify-check-runtime-env) ... ok
* [x] general: add a badge even for license, like: `[![license - APACHE-2.0](https://img.shields.io/npm/l/fastify-example.svg)](http://opensource.org/licenses/APACHE-2.0)` ... not here because there is no package published at npm for this repo, but for others do it
* [x] general: at DockerHub, update autobuild rules to trigger even the push of git tags, to build (and tag) related images; one for usual 'Dockerfile', and another for 'Dockerfile.alpine' with suffix '-alpine' ... ok
* [x] general: remove badges (at the top of README) for latest release at npm and number of downloads (because this is not published there, it's not a library/framework), and even the code coverage ... ok
* [x] general: add badges (at the top of README) for the number of pulls of Docker images ... ok, but add only one badge for it at the moment (not sure it's possible to add many related to different 'latest' tags I set)
* [x] general: add badges (at the top of README) for Docker images (latest releases) if possible ... maybe later
* [x] general: check if use [node-fetch - npmjs](https://www.npmjs.com/package/node-fetch) to get content via HTTP/HTTPS, in a similar way to Browsers; for example look at this [article](https://humanwhocodes.com/snippets/2019/01/nodejs-medium-api-fetch/) ... maybe later
* [x] general: check if add all feature flags to both Dockerfiles, as ENV statements ... maybe later, they are overridable the same from the command-line, so this would be more a documentation improvement
* [x] general: create 'docs/Docker-publish.md' with detailed info on how to publish images to DockerHub ... ok
* [x] general: update README clarifying usage of Docker images published at DockerHub at [smartiniatdocker09/fastify-example - DockerHub](https://hub.docker.com/r/smartiniatdocker09/fastify-example); and explain that there are two: the normal (even with DEV dependencies, bash shell, etc), and another minimal based on Alpine (and with setting for Production environment only) ... ok
* [x] general: remove dependency from 'semver', not really used directly, and now used by my plugin 'fastify-check-runtime-env' (so safe to remove) ... ok
* [x] general: configure my plugin 'fastify-check-runtime-env' to throw error if current Node.js version is not compatible with the one set in 'package.json'; handle with a feature flag if log a warning, or if throw an error (by default) ... ok, but for simplicity use only a single feature flag now 'FEATURE_CHECK_RUNTIME_ENV_DISABLE' to throw an exception if needed; and update README with some info on it
* [x] general: update changelog for the upcoming release ... ok
* [x] general: in changelog add even references to images published at DockerHub, with related tags: 'latest' and '2.3.0' for the normal image, and 'latest-alpine' and '2.3.0-alpine' for the other based on Alpine Linux ... add a similar reference even in changelog for (previous) release '2.2.0' ... ok
* [x] general: tag sources, at least going to '2.3.0' ... ok
* [x] general: publish current image to DockerHub, and tag there accordingly ... note that with automatic builds defined (on push and on tags, this maybe is no more needed) ... ok


---------------
